<!DOCTYPE html>
<html>
  <head>
    <title>Smart Garden - Blockchain Auth</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; padding: 40px; color: #333; }
      .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); max-width: 800px; margin: auto; }
      h1 { text-align: center; color: #2e7d32; }
      .status-box { background: #e8f5e9; padding: 10px; border-radius: 6px; margin-bottom: 20px; text-align: center; }
      .status { color: #43a047; font-weight: bold; }
      .sensor-item { padding: 15px; border-bottom: 1px solid #eee; }
      .sensor-item:last-child { border-bottom: none; }
      .address { font-size: 0.8em; color: #666; font-family: monospace; }
      .value { font-size: 1.2em; color: #1565c0; font-weight: bold; }
    </style>
  </head>
  <body>
    <div class="card">
      <h1>ğŸŒ¿ Smart Garden IoT Ledger</h1>
      <div class="status-box">
        Status: <span class="status">â— Connected to Hyperledger Sawtooth</span>
      </div>
      <div id="data-list">Äang xÃ¡c thá»±c dá»¯ liá»‡u tá»« Blockchain...</div>
    </div>

    <script>
      async function fetchData() {
        try {
          // VÃ¬ index.html Ä‘Æ°á»£c serve tá»« port 3001, dÃ¹ng Ä‘Æ°á»ng dáº«n tÆ°Æ¡ng Ä‘á»‘i lÃ  an toÃ n nháº¥t
          const res = await fetch("/api/data");
          const data = await res.json();
          const container = document.getElementById("data-list");

          if (data.error) {
            container.innerHTML = `<p style="color:red;">${data.error}</p>`;
            return;
          }

          container.innerHTML = data.map(item => `
            <div class="sensor-item">
              <div class="address">Address: ${item.address}</div>
              <div class="value">
                ğŸ“Š Sensor Value: ${(parseInt(item.raw) / 100).toFixed(2)}
              </div>
            </div>
          `).join("");
        } catch (err) {
          console.error("Fetch error:", err);
        }
      }

      // Cáº­p nháº­t dá»¯ liá»‡u má»—i 3 giÃ¢y (3000ms)
      setInterval(fetchData, 3000);
      fetchData(); // Gá»i láº§n Ä‘áº§u ngay khi táº£i trang
    </script>
  </body>
</html>